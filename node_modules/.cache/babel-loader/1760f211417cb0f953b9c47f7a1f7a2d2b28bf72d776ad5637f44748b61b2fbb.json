{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Brice FRIGO/Desktop/tuto-react-qui-marche/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Brice FRIGO/Desktop/tuto-react-qui-marche/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"C:/Users/Brice FRIGO/Desktop/tuto-react-qui-marche/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/Brice FRIGO/Desktop/tuto-react-qui-marche/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useState}from\"react\";import{collection,addDoc,serverTimestamp,onSnapshot,query,where}from'@firebase/firestore';import{auth,db}from'../firebase-config';import'../css/style.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var Chat=function Chat(props){var room=props.room;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),newMessage=_useState4[0],setNewMessage=_useState4[1];var messagesRef=collection(db,\"messages\");useEffect(function(){var queryMessages=query(messagesRef,where(\"room\",\"==\",room));var unsucribe=onSnapshot(queryMessages,function(snapshot){var messages=[];snapshot.forEach(function(doc){messages.push(_objectSpread(_objectSpread({},doc.data()),{},{id:doc.id}));});setMessages(messages);});return function(){return unsucribe();};},[]);var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(newMessage===\"\")){_context.next=3;break;}return _context.abrupt(\"return\");case 3:_context.next=5;return addDoc(messagesRef,{text:newMessage,createAt:serverTimestamp(),user:auth.currentUser.displayName,room:room});case 5:setNewMessage(\"\");case 6:case\"end\":return _context.stop();}},_callee);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"important\",children:/*#__PURE__*/_jsx(\"h1\",{children:room.toUpperCase()})}),/*#__PURE__*/_jsx(\"section\",{className:\"text\",children:/*#__PURE__*/_jsx(\"div\",{className:\"messages\",children:messages.sort(function(a,b){var _a$createAt,_b$createAt;return((_a$createAt=a.createAt)===null||_a$createAt===void 0?void 0:_a$createAt.seconds)-((_b$createAt=b.createAt)===null||_b$createAt===void 0?void 0:_b$createAt.seconds);}).map(function(messages,i){return/*#__PURE__*/_jsx(\"div\",{className:\"message\",children:/*#__PURE__*/_jsxs(\"span\",{children:[messages.user,\" : \\u2794 \",messages.text]})});})})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"new-message-from\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"new-message-input\",placeholder:\"Votre message...\",onChange:function onChange(e){return setNewMessage(e.target.value);},value:newMessage}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"send-button\",children:\"Envoyer\"})]})]});};","map":{"version":3,"names":["useEffect","useState","collection","addDoc","serverTimestamp","onSnapshot","query","where","auth","db","Chat","props","room","messages","setMessages","newMessage","setNewMessage","messagesRef","queryMessages","unsucribe","snapshot","forEach","doc","push","data","id","handleSubmit","e","preventDefault","text","createAt","user","currentUser","displayName","toUpperCase","sort","a","b","seconds","map","i","target","value"],"sources":["C:/Users/Brice FRIGO/Desktop/tuto-react-qui-marche/src/components/Chat.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { collection ,addDoc, serverTimestamp, onSnapshot, query, where } from '@firebase/firestore';\nimport { auth, db } from '../firebase-config';\nimport '../css/style.css'\n\nexport const Chat = (props) =>{\n\n    const {room} = props;\n\n    const [messages, setMessages] = useState([]);\n    const [newMessage, setNewMessage] = useState(\"\");\n    const messagesRef = collection(db, \"messages\");\n\n    useEffect(() => {\n        const queryMessages = query(messagesRef, where(\"room\", \"==\", room));\n        const unsucribe = onSnapshot(queryMessages, (snapshot) => {\n            let messages = [];\n            snapshot.forEach((doc) => {\n                messages.push({...doc.data(), id: doc.id})\n            });\n            setMessages(messages)\n        });\n\n        return () => unsucribe();  \n    }, []);\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        if(newMessage === \"\") return;\n\n        await addDoc(messagesRef, {\n            text: newMessage,\n            createAt: serverTimestamp(),\n            user: auth.currentUser.displayName,\n            room,\n        });\n\n        setNewMessage(\"\");\n    };\n\n    return( \n    \n    <div className=\"chat-app\">\n        <div className=\"important\">\n            <h1>{room.toUpperCase()}</h1>\n        </div>\n        <section className=\"text\">\n            <div className=\"messages\">\n                {messages.sort((a, b) => a.createAt?.seconds - b.createAt?.seconds).map((messages, i) => \n                <div className=\"message\">\n                    <span>{messages.user} : âž” {messages.text}</span> \n                </div>\n                )}\n            </div>\n        </section>\n\n        <form  onSubmit={handleSubmit} className=\"new-message-from\">\n            <input \n                className=\"new-message-input\"\n                placeholder=\"Votre message...\"\n                onChange={(e) => setNewMessage(e.target.value)}\n                value={newMessage}\n            />\n\n            <button type=\"submit\" className=\"send-button\">Envoyer</button>\n        </form>\n    </div>\n    )\n}"],"mappings":"+iBAAA,OAASA,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAC3C,OAASC,UAAU,CAAEC,MAAM,CAAEC,eAAe,CAAEC,UAAU,CAAEC,KAAK,CAAEC,KAAK,KAAQ,qBAAqB,CACnG,OAASC,IAAI,CAAEC,EAAE,KAAQ,oBAAoB,CAC7C,MAAO,kBAAkB,yFAEzB,MAAO,IAAMC,KAAI,CAAG,QAAPA,KAAI,CAAIC,KAAK,CAAI,CAE1B,GAAOC,KAAI,CAAID,KAAK,CAAbC,IAAI,CAEX,cAAgCX,QAAQ,CAAC,EAAE,CAAC,wCAArCY,QAAQ,eAAEC,WAAW,eAC5B,eAAoCb,QAAQ,CAAC,EAAE,CAAC,yCAAzCc,UAAU,eAAEC,aAAa,eAChC,GAAMC,YAAW,CAAGf,UAAU,CAACO,EAAE,CAAE,UAAU,CAAC,CAE9CT,SAAS,CAAC,UAAM,CACZ,GAAMkB,cAAa,CAAGZ,KAAK,CAACW,WAAW,CAAEV,KAAK,CAAC,MAAM,CAAE,IAAI,CAAEK,IAAI,CAAC,CAAC,CACnE,GAAMO,UAAS,CAAGd,UAAU,CAACa,aAAa,CAAE,SAACE,QAAQ,CAAK,CACtD,GAAIP,SAAQ,CAAG,EAAE,CACjBO,QAAQ,CAACC,OAAO,CAAC,SAACC,GAAG,CAAK,CACtBT,QAAQ,CAACU,IAAI,gCAAKD,GAAG,CAACE,IAAI,EAAE,MAAEC,EAAE,CAAEH,GAAG,CAACG,EAAE,GAAE,CAC9C,CAAC,CAAC,CACFX,WAAW,CAACD,QAAQ,CAAC,CACzB,CAAC,CAAC,CAEF,MAAO,kBAAMM,UAAS,EAAE,GAC5B,CAAC,CAAE,EAAE,CAAC,CAEN,GAAMO,aAAY,4FAAG,iBAAOC,CAAC,mHACzBA,CAAC,CAACC,cAAc,EAAE,CAAC,KAChBb,UAAU,GAAK,EAAE,wFAEdZ,OAAM,CAACc,WAAW,CAAE,CACtBY,IAAI,CAAEd,UAAU,CAChBe,QAAQ,CAAE1B,eAAe,EAAE,CAC3B2B,IAAI,CAAEvB,IAAI,CAACwB,WAAW,CAACC,WAAW,CAClCrB,IAAI,CAAJA,IACJ,CAAC,CAAC,QAEFI,aAAa,CAAC,EAAE,CAAC,CAAC,qDACrB,kBAZKU,aAAY,4CAYjB,CAED,mBAEA,aAAK,SAAS,CAAC,UAAU,wBACrB,YAAK,SAAS,CAAC,WAAW,uBACtB,oBAAKd,IAAI,CAACsB,WAAW,EAAE,EAAM,EAC3B,cACN,gBAAS,SAAS,CAAC,MAAM,uBACrB,YAAK,SAAS,CAAC,UAAU,UACpBrB,QAAQ,CAACsB,IAAI,CAAC,SAACC,CAAC,CAAEC,CAAC,oCAAK,cAAAD,CAAC,CAACN,QAAQ,sCAAV,YAAYQ,OAAO,gBAAGD,CAAC,CAACP,QAAQ,sCAAV,YAAYQ,OAAO,IAAC,CAACC,GAAG,CAAC,SAAC1B,QAAQ,CAAE2B,CAAC,qBACpF,YAAK,SAAS,CAAC,SAAS,uBACpB,wBAAO3B,QAAQ,CAACkB,IAAI,CAAC,YAAK,CAAClB,QAAQ,CAACgB,IAAI,GAAQ,EAC9C,GACL,EACC,EACA,cAEV,cAAO,QAAQ,CAAEH,YAAa,CAAC,SAAS,CAAC,kBAAkB,wBACvD,cACI,SAAS,CAAC,mBAAmB,CAC7B,WAAW,CAAC,kBAAkB,CAC9B,QAAQ,CAAE,kBAACC,CAAC,QAAKX,cAAa,CAACW,CAAC,CAACc,MAAM,CAACC,KAAK,CAAC,EAAC,CAC/C,KAAK,CAAE3B,UAAW,EACpB,cAEF,eAAQ,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,aAAa,UAAC,SAAO,EAAS,GAC3D,GACL,CAEV,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}